package org.cardanofoundation.cip113;

import com.bloxbean.cardano.aiken.AikenScriptUtil;
import com.bloxbean.cardano.aiken.AikenTransactionEvaluator;
import com.bloxbean.cardano.client.address.AddressProvider;
import com.bloxbean.cardano.client.address.Credential;
import com.bloxbean.cardano.client.api.model.Amount;
import com.bloxbean.cardano.client.api.util.ValueUtil;
import com.bloxbean.cardano.client.function.helper.SignerProviders;
import com.bloxbean.cardano.client.plutus.blueprint.PlutusBlueprintUtil;
import com.bloxbean.cardano.client.plutus.blueprint.model.PlutusVersion;
import com.bloxbean.cardano.client.plutus.spec.BigIntPlutusData;
import com.bloxbean.cardano.client.plutus.spec.BytesPlutusData;
import com.bloxbean.cardano.client.plutus.spec.ConstrPlutusData;
import com.bloxbean.cardano.client.plutus.spec.ListPlutusData;
import com.bloxbean.cardano.client.quicktx.ScriptTx;
import com.bloxbean.cardano.client.quicktx.Tx;
import com.bloxbean.cardano.client.transaction.spec.*;
import com.bloxbean.cardano.client.util.HexUtil;
import com.easy1staking.cardano.model.AssetType;
import com.fasterxml.jackson.core.JsonProcessingException;
import com.fasterxml.jackson.databind.ObjectMapper;
import lombok.extern.slf4j.Slf4j;
import org.cardanofoundation.cip113.model.blueprint.Plutus;
import org.cardanofoundation.cip113.model.bootstrap.ProtocolBootstrapParams;
import org.cardanofoundation.cip113.model.onchain.RegistryNodeParser;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;

import java.math.BigInteger;
import java.util.List;

@Slf4j
public class TransactionDeserializationTest {

    private static final ObjectMapper MAPPER = new ObjectMapper();

    @Test
    public void deserialise_1() throws Exception {
        // dummy - mesh tx
        var transaction = Transaction.deserialize(HexUtil.decodeHexString("84a800d9010282825820772afbfc4587c4b3c6a915df3844598f396982c42a00941795e1dfa5b7d4250701825820ae081ba98681bc80cf62046afb8999cb20af26a83466018573fc490d29a9cd510001848258390032e7e00eae28502a2aa271cf4202b1b01b94ca8efe642e380c93d5e20510c0ce8306f183c94d1636f64f6214b774bb9f88852c6acf4279241a000f4240a300583910f2182b00a37bd746e20575c9af01ab31312213514cd31e872e0a2a3e0510c0ce8306f183c94d1636f64f6214b774bb9f88852c6acf42792401821a0013d620a1581c93953ade00698f887283f7981297e5a84d19dfa3928371dbe429dee2a14764756d6d792d311a3b9ac5a9028201d81843d87980a300583910f2182b00a37bd746e20575c9af01ab31312213514cd31e872e0a2a3e2b3a464af242930cfe199a13907ea68752e75f4a8dcc2115fe6a9b3601821a0013d620a1581c93953ade00698f887283f7981297e5a84d19dfa3928371dbe429dee2a14764756d6d792d31186f028201d81843d879808258390032e7e00eae28502a2aa271cf4202b1b01b94ca8efe642e380c93d5e20510c0ce8306f183c94d1636f64f6214b774bb9f88852c6acf4279241a0293a82a021a0021c36105a2581df017e9e9e3412e7198877557fab1181f394ed36cf5db27b418d3f6899000581df05db48c6383a98a53ca163e58c0f8c9dbc932d65ba070daff97851282000b582041c08300fe8d006581b2b2621f51591c387e8c0c833c09a710d644a33c00e05a0dd9010281825820299b430404db76926ab249a04196b79f26d44ef366107d475f8e1fc284574e57000ed9010281581c0510c0ce8306f183c94d1636f64f6214b774bb9f88852c6acf42792412d901028282582061fae36e28a62a65496907c9660da9cf5d27fa0e9054a04581e1d8a087fbd93e008258209ba15b5583849466d0ea97cea413bfadf346f3f77ef792196418d383bd650ad501a207d901028358c058be0101003229800aba2aba1aab9faab9eaab9dab9a48888896600264646644b30013370e900118031baa0018994c004c028006601460160032259800800c528456600266ebcc024c03000403e2946266004004601a002804100b2444660020026eacc034c038c038c038c038c038c038c02cdd518068040c01cdd5000c59005180380098039804000980380098019baa0078a4d1365640044c0122d87a9f581c5db48c6383a98a53ca163e58c0f8c9dbc932d65ba070daff97851282ff000158595857010100323232323225333002323232323253330073370e900218041baa0011323370e6eb400d209003300a300937540022940c024c02800cc020008c01c008c01c004c010dd50008a4c26cacae6955ceaab9e5742ae881590c75590c720101003229800aba2aba1aba0aab9faab9eaab9dab9a9bae0024888888896600264653001300900198049805000cc0240092225980099b8748010c020dd5001466002601860126ea800a6e1d20009b874800a446466002002006446600600260040053008375400691111192cc004c01400a264b300130140018998021bac3013001225980080140122646644b3001300b002899192cc004c06c00a0071640606eb4c064004c054dd5001c56600260140051323259800980d801400e2c80c0dd6980c800980a9baa0038b2026404c60246ea80044c008c05c00cc05400901345901118079baa0098acc004c01000a2646464653001375a602c003375a602c009375a602c0049112cc004c0680122660146eb0c064018896600200500a8991801180e8019bad301b002406516405c301600130150013014001300f375401316403480684cc88c8cc004004dd6180198089baa0092259800800c5a264b3001330043756600a60266ea8c014c04cdd500080844c8c8cc8966002601a602c6ea800a2646644b3001301e001899802180e8008cc004c030c068dd5002cdd7180e980d1baa0059180f180f980f980f980f980f980f800c8896600266e2400520008801456600200514bd70466002007302100299b8000148005003203c406d22598009809180d9baa002899191919194c004dd71812000cdd71812002cdd718120024c0900092222598009814802c4cc03cc0a001c4cc03c00402a2c8130604800260460026044002604200260386ea800a2c80d244646600200200644b30010018a508acc004cdd79810800801c528c4cc008008c08800501c203e4888888c8cc8966002603260446ea8076330012259800800c5268992cc00400629344c96600266e40dd7181318150019bae30260018998020021981480098158014590251814800a04e30290014099222232330010010052259800800c4cc0accdd81ba9005374c00897adef6c608994c004dd71814800cdd59815000cc0b80092225980099b9000900389981799bb037520126e980200162b30013371e01200719800804c022005233030337606ea4028dd30008014400500744cc0bccdd81ba9003374c0046600c00c002815902b0c0b000502a48888c8cc004004014896600200313302b337606ea4014dd400225eb7bdb1822653001375c6052003375a6054003302e00248896600266e4002400e26605e66ec0dd48049ba80080058acc004cdc7804801c6600201300880148cc0c0cdd81ba900a37500020051001401d13302f337606ea400cdd400119803003000a05640ac302c00140a9259800800c528c528204a891111192cc004c07c00600513003001409c66e0001000e444653001001802400d0011112cc00400a200319800801cc0b400a660086058004002801902a2444444664464944c8c8cc004004c8cc8a600200532330010010022259800800c52f5bded8c113298009bae30320019bab3033001981b8012444b30013371e9101000038800c4cc0e0cdd81ba9003374c0046600c00c00281a0606a002819a6eb0c0ccc0c0dd501552f5bded8c0801088896600200715980099baf4c01018000374e00510018b2060899192cc0040122d1329800803cc0e401a607200b59800acc004c0acc0d0dd5000c4c8c8cc064004566002660506eacc0a4c0dcdd51814981b9baa00201c8acc004cdc79bae303a303737540020091598009980c00a9812181b9baa0018a518b206a8b206a8b206a3022302830363754002660280106eb4c0e0c0d4dd5000c4c8c8cc064004566002660506eacc0a4c0dcdd51814981b9baa00201c8acc004cdc81bae303a3037375400200915980099b90004375c6052606e6ea800629422c81aa2c81aa2c81a8c088c0a0c0d8dd50009980a0041bad303830353754002819a26530010019bab3036004802a00222259800801440062653001004981e801ccc8966002606200310048cc004012011323200230130013303d337606ea4008dd4000a5eb7bdb1824444464b3001301b00180144c00c00503f194c004012011007911114c004016007004801400500620385019405c81c8dd7181c0009bad30390014010607600481ca20088199007181b802206a375c6064002606a006819a60026eb0c0c4c0b8dd501352f5bded8c1225980099baf303330303754606660606ea8c088c0c0dd500100b44c966002604e60606ea8006264b300130283031375400313259800981498191baa0018992cc004c8cc004004dd6181c181c981c981c981c981c981c981c981c981a9baa02d2259800800c528456600266e3cdd7181c800801c528c4cc008008c0e8005034206e8998050029bab302630343754604c60686ea801a2c8190dd7181b18199baa0018acc004c8cc004004dd5980c181a1baa02c2259800800c528456600266ebcc0d0c0e000400e29462660040046072002819903644cc024010dd5981298199baa30253033375400b1640c48188c0d4c0c8dd5000c59030181a18189baa0018b205e302230303754606660606ea8c088c0c0dd50014400502e200c3758603e605a6ea80948966002003149a264664466446600400400244b30010018801c4ca60026eb8c0cc0066eb4c0d00066600600660700049112cc004cdc480119199119801001000912cc00400600713233225980099b910090028acc004cdc78048014400600c81da26600a00a608200881d8dd7181d0009bad303b001303d00140ec64646600200201e44b3001001801c4c8cc896600266e4403c00a2b30013371e01e0051001803207889980280298210022078375c60760026eacc0f0004c0f800503c0a5eb7bdb180520008a4d1640d4303600140d06eacc0c400cdd718170009980180198198011818800a05e98009bac3018302b37540474bd6f7b6304896600266ebcc0c0c0b4dd5181818169baa0020138992cc004c090c0b4dd5000c5660026048605a6ea8c0c4c0b8dd5000c4cc010008dd5981018171baa0038b20588b2058301f302d37546060605a6ea800a20028159003180300311194c0040060070024004444b30010028800c4ca60020093033003cc00400a6eb8c0b80066eacc0bc0064444464b3001300f00180144c00c00503319194c00400600d0054004444b30010028800c4ca6002009303d003cc00400a6eb8c0e00066eb4c0e400600a80a1004181d8012072500d402c8020c0c400902f2264664466453001375a6056005375a605660580053014301a3028375400337586056008911119807001099912cc004cdc3994c004006900040110011112cc0040062900044c8cc896600266ebcc0dcc0d0dd5181b981a1baa30263034375400603515980099baf303730343754002606e60686ea8c098c0d0dd5001c56600266ebcc098c0d0dd50009ba60028acc004cdd79810981a1baa001302130343754604c60686ea800e2b3001980099baf302630343754604c60686ea800cdd3001528528a06489803cc00401a600e00b303800440191640c91640c91640c91640c91640c864660020026eacc094c0ccdd5181298199baa0022259800800c52f5bded8c113298009bae30340019bab3035001981c8012444b30013372201800715980099b8f00c0038800c401503644cc0e8cdd81ba9003374c0046600c00c00281b0606e00281a8cc044dd6180f98191baa02a33700014006660206eb0c0d0c0c4dd50149bad303400140c800b1598009980f9bab3020302e37546040605c6ea801c04e2b30013300f00c3031303230323032302e375400915980099b87323300100137586064605e6ea809c896600200314800226644b30013375e606a60646ea8c0d4c0c8dd5181218191baa00201889802800c4005030181980099801001181a000a0620058a518b20588b20588b20588b2058375c605e60586ea8008dc024004302a0023300537586030604c6ea8078004c0a0004dd6981380098119baa01d40844464b30010018b44c09c0050251980180100099198008009bab30063022375403444b30010018a5eb8226604a6044604c00266004004604e0028120c00c00d16406c6eb8c06c004c070004c05cdd500145901518009803980a9baa0032232598009807000c4c8c966002603c0050048b2036375c603800260306ea800e2b3001300d001899192cc004c07800a00916406c6eb8c070004c060dd5001c59016202c30163754004464b30013370e9002180a9baa0018980c980b1baa0018b20283002301537540024602e6030603000313300300330170024044602a00280988c048c04c00488c8cc00400400c896600200314a11325980099b91004001899b8f004001899801801980b8012022375c6022602a002809916401c300900130043754013149a26cac801098011e581c872cf2039513edce5e075f50d64091c8b2820fa85b4466c78bf14c16000105a382000082d87980821a006acfc01ab2d05e008203008218c8821a006acfc01ab2d05e0082030182d8799f9fd8799f01ffffff821a006acfc01ab2d05e00f5f6"));
        log.info("tx: {}", MAPPER.writeValueAsString(transaction));
    }

    @Test
    public void deserialise_2() throws Exception {
        // dummy - java tx
        var transaction = Transaction.deserialize(HexUtil.decodeHexString("84aa00d9010282825820299b430404db76926ab249a04196b79f26d44ef366107d475f8e1fc284574e5701825820772afbfc4587c4b3c6a915df3844598f396982c42a00941795e1dfa5b7d425070101848258390032e7e00eae28502a2aa271cf4202b1b01b94ca8efe642e380c93d5e20510c0ce8306f183c94d1636f64f6214b774bb9f88852c6acf4279241a000f4240a300583910f2182b00a37bd746e20575c9af01ab31312213514cd31e872e0a2a3e0510c0ce8306f183c94d1636f64f6214b774bb9f88852c6acf42792401821a00128bbca1581c93953ade00698f887283f7981297e5a84d19dfa3928371dbe429dee2a14764756d6d792d311a3b9ac5a9028201d81843d87980a300583910f2182b00a37bd746e20575c9af01ab31312213514cd31e872e0a2a3e2b3a464af242930cfe199a13907ea68752e75f4a8dcc2115fe6a9b3601821a0012593aa1581c93953ade00698f887283f7981297e5a84d19dfa3928371dbe429dee2a14764756d6d792d31186f028201d81843d879808258390032e7e00eae28502a2aa271cf4202b1b01b94ca8efe642e380c93d5e20510c0ce8306f183c94d1636f64f6214b774bb9f88852c6acf4279241b0000000175a46a0b021a0008dfa305a2581df017e9e9e3412e7198877557fab1181f394ed36cf5db27b418d3f6899000581df05db48c6383a98a53ca163e58c0f8c9dbc932d65ba070daff97851282000b5820e1d5e658d39b4f3de151c3478a3537d96012464d413cbb7fd528c1f7ea03bd7e0dd901028182582018c39bbf83b04f32146718d2fb7925ec9e71a44cf709a021490767a8143c9cc1060ed9010281581c0510c0ce8306f183c94d1636f64f6214b774bb9f88852c6acf427924108258390032e7e00eae28502a2aa271cf4202b1b01b94ca8efe642e380c93d5e20510c0ce8306f183c94d1636f64f6214b774bb9f88852c6acf4279241a02ea93cb111a00105cb512d901028282582061fae36e28a62a65496907c9660da9cf5d27fa0e9054a04581e1d8a087fbd93e008258209ba15b5583849466d0ea97cea413bfadf346f3f77ef792196418d383bd650ad501a205a382000182d879808219496f1a007f985b8203008218c8821926c01a002a605982030182d8799f9fd8799f01ffffff821a000552441a06dd191b07d901028358c058be0101003229800aba2aba1aab9faab9eaab9dab9a48888896600264646644b30013370e900118031baa0018994c004c028006601460160032259800800c528456600266ebcc024c03000403e2946266004004601a002804100b2444660020026eacc034c038c038c038c038c038c038c02cdd518068040c01cdd5000c59005180380098039804000980380098019baa0078a4d1365640044c0122d87a9f581c5db48c6383a98a53ca163e58c0f8c9dbc932d65ba070daff97851282ff0001590c75590c720101003229800aba2aba1aba0aab9faab9eaab9dab9a9bae0024888888896600264653001300900198049805000cc0240092225980099b8748010c020dd5001466002601860126ea800a6e1d20009b874800a446466002002006446600600260040053008375400691111192cc004c01400a264b300130140018998021bac3013001225980080140122646644b3001300b002899192cc004c06c00a0071640606eb4c064004c054dd5001c56600260140051323259800980d801400e2c80c0dd6980c800980a9baa0038b2026404c60246ea80044c008c05c00cc05400901345901118079baa0098acc004c01000a2646464653001375a602c003375a602c009375a602c0049112cc004c0680122660146eb0c064018896600200500a8991801180e8019bad301b002406516405c301600130150013014001300f375401316403480684cc88c8cc004004dd6180198089baa0092259800800c5a264b3001330043756600a60266ea8c014c04cdd500080844c8c8cc8966002601a602c6ea800a2646644b3001301e001899802180e8008cc004c030c068dd5002cdd7180e980d1baa0059180f180f980f980f980f980f980f800c8896600266e2400520008801456600200514bd70466002007302100299b8000148005003203c406d22598009809180d9baa002899191919194c004dd71812000cdd71812002cdd718120024c0900092222598009814802c4cc03cc0a001c4cc03c00402a2c8130604800260460026044002604200260386ea800a2c80d244646600200200644b30010018a508acc004cdd79810800801c528c4cc008008c08800501c203e4888888c8cc8966002603260446ea8076330012259800800c5268992cc00400629344c96600266e40dd7181318150019bae30260018998020021981480098158014590251814800a04e30290014099222232330010010052259800800c4cc0accdd81ba9005374c00897adef6c608994c004dd71814800cdd59815000cc0b80092225980099b9000900389981799bb037520126e980200162b30013371e01200719800804c022005233030337606ea4028dd30008014400500744cc0bccdd81ba9003374c0046600c00c002815902b0c0b000502a48888c8cc004004014896600200313302b337606ea4014dd400225eb7bdb1822653001375c6052003375a6054003302e00248896600266e4002400e26605e66ec0dd48049ba80080058acc004cdc7804801c6600201300880148cc0c0cdd81ba900a37500020051001401d13302f337606ea400cdd400119803003000a05640ac302c00140a9259800800c528c528204a891111192cc004c07c00600513003001409c66e0001000e444653001001802400d0011112cc00400a200319800801cc0b400a660086058004002801902a2444444664464944c8c8cc004004c8cc8a600200532330010010022259800800c52f5bded8c113298009bae30320019bab3033001981b8012444b30013371e9101000038800c4cc0e0cdd81ba9003374c0046600c00c00281a0606a002819a6eb0c0ccc0c0dd501552f5bded8c0801088896600200715980099baf4c01018000374e00510018b2060899192cc0040122d1329800803cc0e401a607200b59800acc004c0acc0d0dd5000c4c8c8cc064004566002660506eacc0a4c0dcdd51814981b9baa00201c8acc004cdc79bae303a303737540020091598009980c00a9812181b9baa0018a518b206a8b206a8b206a3022302830363754002660280106eb4c0e0c0d4dd5000c4c8c8cc064004566002660506eacc0a4c0dcdd51814981b9baa00201c8acc004cdc81bae303a3037375400200915980099b90004375c6052606e6ea800629422c81aa2c81aa2c81a8c088c0a0c0d8dd50009980a0041bad303830353754002819a26530010019bab3036004802a00222259800801440062653001004981e801ccc8966002606200310048cc004012011323200230130013303d337606ea4008dd4000a5eb7bdb1824444464b3001301b00180144c00c00503f194c004012011007911114c004016007004801400500620385019405c81c8dd7181c0009bad30390014010607600481ca20088199007181b802206a375c6064002606a006819a60026eb0c0c4c0b8dd501352f5bded8c1225980099baf303330303754606660606ea8c088c0c0dd500100b44c966002604e60606ea8006264b300130283031375400313259800981498191baa0018992cc004c8cc004004dd6181c181c981c981c981c981c981c981c981c981a9baa02d2259800800c528456600266e3cdd7181c800801c528c4cc008008c0e8005034206e8998050029bab302630343754604c60686ea801a2c8190dd7181b18199baa0018acc004c8cc004004dd5980c181a1baa02c2259800800c528456600266ebcc0d0c0e000400e29462660040046072002819903644cc024010dd5981298199baa30253033375400b1640c48188c0d4c0c8dd5000c59030181a18189baa0018b205e302230303754606660606ea8c088c0c0dd50014400502e200c3758603e605a6ea80948966002003149a264664466446600400400244b30010018801c4ca60026eb8c0cc0066eb4c0d00066600600660700049112cc004cdc480119199119801001000912cc00400600713233225980099b910090028acc004cdc78048014400600c81da26600a00a608200881d8dd7181d0009bad303b001303d00140ec64646600200201e44b3001001801c4c8cc896600266e4403c00a2b30013371e01e0051001803207889980280298210022078375c60760026eacc0f0004c0f800503c0a5eb7bdb180520008a4d1640d4303600140d06eacc0c400cdd718170009980180198198011818800a05e98009bac3018302b37540474bd6f7b6304896600266ebcc0c0c0b4dd5181818169baa0020138992cc004c090c0b4dd5000c5660026048605a6ea8c0c4c0b8dd5000c4cc010008dd5981018171baa0038b20588b2058301f302d37546060605a6ea800a20028159003180300311194c0040060070024004444b30010028800c4ca60020093033003cc00400a6eb8c0b80066eacc0bc0064444464b3001300f00180144c00c00503319194c00400600d0054004444b30010028800c4ca6002009303d003cc00400a6eb8c0e00066eb4c0e400600a80a1004181d8012072500d402c8020c0c400902f2264664466453001375a6056005375a605660580053014301a3028375400337586056008911119807001099912cc004cdc3994c004006900040110011112cc0040062900044c8cc896600266ebcc0dcc0d0dd5181b981a1baa30263034375400603515980099baf303730343754002606e60686ea8c098c0d0dd5001c56600266ebcc098c0d0dd50009ba60028acc004cdd79810981a1baa001302130343754604c60686ea800e2b3001980099baf302630343754604c60686ea800cdd3001528528a06489803cc00401a600e00b303800440191640c91640c91640c91640c91640c864660020026eacc094c0ccdd5181298199baa0022259800800c52f5bded8c113298009bae30340019bab3035001981c8012444b30013372201800715980099b8f00c0038800c401503644cc0e8cdd81ba9003374c0046600c00c00281b0606e00281a8cc044dd6180f98191baa02a33700014006660206eb0c0d0c0c4dd50149bad303400140c800b1598009980f9bab3020302e37546040605c6ea801c04e2b30013300f00c3031303230323032302e375400915980099b87323300100137586064605e6ea809c896600200314800226644b30013375e606a60646ea8c0d4c0c8dd5181218191baa00201889802800c4005030181980099801001181a000a0620058a518b20588b20588b20588b2058375c605e60586ea8008dc024004302a0023300537586030604c6ea8078004c0a0004dd6981380098119baa01d40844464b30010018b44c09c0050251980180100099198008009bab30063022375403444b30010018a5eb8226604a6044604c00266004004604e0028120c00c00d16406c6eb8c06c004c070004c05cdd500145901518009803980a9baa0032232598009807000c4c8c966002603c0050048b2036375c603800260306ea800e2b3001300d001899192cc004c07800a00916406c6eb8c070004c060dd5001c59016202c30163754004464b30013370e9002180a9baa0018980c980b1baa0018b20283002301537540024602e6030603000313300300330170024044602a00280988c048c04c00488c8cc00400400c896600200314a11325980099b91004001899b8f004001899801801980b8012022375c6022602a002809916401c300900130043754013149a26cac801098011e581c872cf2039513edce5e075f50d64091c8b2820fa85b4466c78bf14c16000158595857010100323232323225333002323232323253330073370e900218041baa0011323370e6eb400d209003300a300937540022940c024c02800cc020008c01c008c01c004c010dd50008a4c26cacae6955ceaab9e5742ae881f5f6"));
        log.info("tx: {}", MAPPER.writeValueAsString(transaction));
    }


}
